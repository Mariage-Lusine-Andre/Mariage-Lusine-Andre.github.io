const i18n = {
  fr: {
    meta_title: "Mariage ‚Äî Lusin√© & Andr√©",

    nav_home: "Accueil",
    nav_program: "Programme",
    nav_gallery: "Galerie",
    nav_places: "Nos lieux",
    nav_rsvp: "Formulaire de pr√©sence",

    hero_kicker: "Notre Mariage",
    hero_names: "Lusin√© & Andr√©",
    hero_name1: "Lusin√©",
    hero_and: "&",
    hero_name2: "Andr√©",

    hero_date: "Samedi 9 mai 2026",
    hero_city: "",
    hero_cta: "Confirmer ma pr√©sence",
    hero_secondary: "Voir le programme",

    cd_days: "Jours",
    cd_hours: "Heures",
    cd_minutes: "Minutes",
    cd_seconds: "Secondes",

    program_title: "Programme",
    program_subtitle: "Le programme de la journ√©e",
    program_1: "C√©r√©monie civile ‚Äî H√¥tel de Ville de Nancy",
    program_1_hint: "(Entr√©e par la place Stanislas)",
    program_2: "Vin d‚Äôhonneur ‚Äî Ch√¢teau de Vandel√©ville",
    program_3: "D√Æner ‚Äî Ch√¢teau de Vandel√©ville",

    gallery_title: "Galerie",
    gallery_subtitle: "Nos souvenirs",
    gallery_note: "Cliquez sur une photo pour l‚Äôouvrir.",

    places_title: "Nos lieux",
    places_subtitle: "Adresses, cartes et itin√©raires",

    townhall_title: "H√¥tel de Ville de Nancy",
    townhall_role: "C√©r√©monie civile ‚Äî 16h00",
    townhall_desc: "",
    townhall_blurb: "Au c≈ìur de Nancy, entr√©e par l‚Äôembl√©matique Place Stanislas, puis c√©l√©bration de notre union √† l‚Äôint√©rieur de l‚ÄôH√¥tel de Ville, dans un cadre charg√© d‚Äôhistoire.",
    townhall_addr_line1: "H√¥tel de Ville de Nancy",
    townhall_addr_line2: "Place Stanislas, 54000 Nancy",

    castle_title: "Ch√¢teau de Vandel√©ville",
    castle_role: "R√©ception ‚Äî 18h00 ‚Ä¢ D√Æner ‚Äî 20h00",
    castle_desc: "3, place du Ch√¢teau √† Vandel√©ville.",
    castle_blurb: "Joyau du XVIII·µâ si√®cle, le Ch√¢teau de Vandel√©ville a travers√© les √©poques en conservant son charme et son prestige.C‚Äôest dans ce cadre enchanteur, charg√© d‚Äôhistoire, que nous vous accueillerons pour le vin d‚Äôhonneur, avant un d√Æner raffin√© et une soir√©e festive qui se prolongera jusqu‚Äô√† 4 heures du matin.",
    castle_addr_line1: "Ch√¢teau de Vandel√©ville",
    castle_addr_line2: "3, place du Ch√¢teau, 54115 Vandel√©ville",
    

    btn_map: "Voir sur la carte",
    btn_route: "Itin√©raire",

    nav_stays: "H√©bergements",
    stays_title: "H√©bergements",
    stays_subtitle: "",
    stays_note: "Chers convives üíõ Pour prolonger la magie au c≈ìur du Saintois et profiter pleinement de la soir√©e jusqu‚Äôau bout de la nuit, voici quelques suggestions d‚Äôh√©bergements √† proximit√© du ch√¢teau.Nous vous invitons √† contacter directement les √©tablissements pour effectuer votre r√©servation.",
    stay_call: "Appeler",

    rsvp_title: "Formulaire de pr√©sence",
    rsvp_subtitle: "Merci de compl√©ter et confirmer votre pr√©sence",
    rsvp_deadline: "Merci de nous confirmer votre pr√©sence avant le 12 avril 2026.",

    footer_names: "Lusin√© & Andr√©",
    footer_meta: "Samedi 9 mai 2026 ‚Äî Nancy"
    },

  hy: {
    meta_title: "’Ä’°÷Ä’Ω’°’∂’´÷Ñ ‚Äî ‘±’∂’§÷Ä’• ÷á ‘º’∏÷Ç’Ω’´’∂’•",

    nav_home: "‘≥’¨’≠’°’æ’∏÷Ä",
    nav_program: "‘æ÷Ä’°’£’´÷Ä",
    nav_gallery: "’ä’°’ø’Ø’•÷Ä’°’Ω÷Ä’°’∞",
    nav_places: "’Ñ’•÷Ä ’æ’°’µ÷Ä’•÷Ä’®",
    nav_rsvp: "’Ñ’°’Ω’∂’°’Ø÷Å’∏÷Ç’©’µ’°’∂ ’±÷á",

    hero_kicker: "’Ñ’•÷Ä ’∞’°÷Ä’Ω’°’∂’´÷Ñ’®",
    hero_names: "‘±’∂’§÷Ä’• ÷á ‘º’∏÷Ç’Ω’´’∂’•",
    hero_name1: "‘±’∂’§÷Ä’•",
    hero_and: "÷á",
    hero_name2: "‘º’∏÷Ç’Ω’´’∂’•",

    hero_date: "’á’°’¢’°’©, 9 ’¥’°’µ’´’Ω 2026",
    hero_city: "",
    hero_cta: "’Ä’°’Ω’ø’°’ø’•’¨ ’¥’°’Ω’∂’°’Ø÷Å’∏÷Ç’©’µ’∏÷Ç’∂’®",
    hero_secondary: "’è’•’Ω’∂’•’¨ ’Æ÷Ä’°’£’´÷Ä’®",

    cd_days: "’ï÷Ä",
    cd_hours: "‘∫’°’¥",
    cd_minutes: "’ê’∏’∫’•",
    cd_seconds: "’é’°’µ÷Ä’Ø’µ’°’∂",

    program_title: "‘æ÷Ä’°’£’´÷Ä",
    program_subtitle: "’ï÷Ä’æ’° ’Æ÷Ä’°’£’´÷Ä’®",
    program_1: "’î’°’≤’°÷Ñ’°÷Å’´’°’Ø’°’∂ ’£÷Ä’°’∂÷Å’¥’°’∂ ’°÷Ä’°÷Ä’∏’≤’∏÷Ç’©’µ’∏÷Ç’∂ - ’Ü’°’∂’Ω’´’´ ÷Ñ’°’≤’°÷Ñ’°’∫’•’ø’°÷Ä’°’∂",
    program_1_hint: "(’Ñ’∏÷Ç’ø÷Ñ’®’ù ’ç’ø’°’∂’´’Ω’¨’°’Ω ’∞÷Ä’°’∫’°÷Ä’°’Ø’´÷Å)",
    program_2: "’ä’°’ø’æ’∏ ’£’´’∂’∏÷Ç ’∞’µ’∏÷Ç÷Ä’°’Ω’´÷Ä’∏÷Ç’©’µ’∏÷Ç’∂  ‚Äî ’é’°’∂’§’•’¨÷á’´’¨’´ ’§’≤’µ’°’Ø",
    program_3: "‘∏’∂’©÷Ä’´÷Ñ ‚Äî ’é’°’∂’§’•’¨÷á’´’¨’´ ’§’≤’µ’°’Ø",

    gallery_title: "’ä’°’ø’Ø’•÷Ä’°’Ω÷Ä’°’∞",
    gallery_subtitle: "’Ñ’•÷Ä ’∞’´’∑’∏’≤’∏÷Ç’©’µ’∏÷Ç’∂’∂’•÷Ä’®",
    gallery_note: "’ç’•’≤’¥’•÷Ñ ’∂’Ø’°÷Ä’´ ’æ÷Ä’°’ù ’¢’°÷Å’•’¨’∏÷Ç ’∞’°’¥’°÷Ä÷â",

    places_title: "’Ñ’•÷Ä ’æ’°’µ÷Ä’•÷Ä’®",
    places_subtitle: "’Ä’°’Ω÷Å’•’∂’•÷Ä, ÷Ñ’°÷Ä’ø’•’¶ ÷á ’•÷Ä’©’∏÷Ç’≤’´",

    townhall_title: "’Ü’°’∂’Ω’´’´ ÷Ñ’°’≤’°÷Ñ’°’∫’•’ø’°÷Ä’°’∂",
    townhall_role: "’î’°’≤’°÷Ñ’°÷Å’´’°’Ø’°’∂ ’£÷Ä’°’∂÷Å’¥’°’∂ ’°÷Ä’°÷Ä’∏’≤’∏÷Ç’©’µ’∏÷Ç’∂ ‚Äî 16:00",
    townhall_desc: "",
    townhall_blurb: "’Ü’°’∂’Ω’´’´ ’Ω÷Ä’ø’∏÷Ç’¥’ù ’∞’°’∂÷Ä’°’∞’°’µ’ø ’ç’ø’°’∂’´’Ω’¨’°’Ω ’∞÷Ä’°’∫’°÷Ä’°’Ø’∏’æ ’¥’∏÷Ç’ø÷Ñ ’£’∏÷Ä’Æ’•’¨’∏’æ, ’¥’•÷Ä ’¥’´’∏÷Ç’©’µ’∏÷Ç’∂’® ’Ø’Ø’∂÷Ñ’æ’´ ÷Ñ’°’≤’°÷Ñ’°’∫’•’ø’°÷Ä’°’∂’´ ’∫’°’ø’¥’°’Ø’°’∂ ÷á ’∑÷Ñ’•’≤ ’¥’´’ª’°’æ’°’µ÷Ä’∏÷Ç’¥÷â",
    townhall_addr_line1: "’Ü’°’∂’Ω’´’´ ÷Ñ’°’≤’°÷Ñ’°’∫’•’ø’°÷Ä’°’∂",
    townhall_addr_line2: "Place Stanislas, Nancy",

    castle_title: "’é’°’∂’§’•’¨÷á’´’¨’´ ’§’≤’µ’°’Ø",
    castle_role: "’ä’°’ø’æ’∏ ’£’´’∂’∏÷Ç ’∞’µ’∏÷Ç÷Ä’°’Ω’´÷Ä’∏÷Ç’©’µ’∏÷Ç’∂ ‚Äî 18:00 ‚Ä¢ ‘∏’∂’©÷Ä’´÷Ñ ‚Äî 20:00",
    castle_desc: "3, Place du Ch√¢teau, Vandel√©ville÷â",
    castle_blurb: "18-÷Ä’§ ’§’°÷Ä’´ ’°’µ’Ω ’∞’¥’°’µ’´’π ’§’≤’µ’°’Ø’®, ’∫’°’∞’∫’°’∂’•’¨’∏’æ ’´÷Ä ’æ’•’∞’∏÷Ç’©’µ’∏÷Ç’∂’∂ ’∏÷Ç ’∫’°’ø’¥’°’Ø’°’∂ ’∑’∏÷Ç’∂’π’®, ’¥’•’¶ ’Ø’∞’µ’∏÷Ç÷Ä’®’∂’Ø’°’¨’´ ’∫’°’ø’æ’∏ ’£’´’∂’∏÷Ç, ’∂÷Ä’¢’°’≥’°’∑’°’Ø ’®’∂’©÷Ä’´÷Ñ’´ ÷á ’∏÷Ç÷Ä’°’≠ ’•÷Ä’•’Ø’∏’µ’´ ’∞’°’¥’°÷Ä, ’∏÷Ä’® ’Ø’∑’°÷Ä’∏÷Ç’∂’°’Ø’æ’´ ’¥’´’∂’π÷á ’¨’∏÷Ç’Ω’°’¢’°÷Å÷â",
    castle_addr_line1: "’é’°’∂’§’•’¨÷á’´’¨’´ ’§’≤’µ’°’Ø",
    castle_addr_line2: "3, Place du Ch√¢teau, Vandel√©ville",

    btn_map: "‘≤’°÷Å’•’¨ ÷Ñ’°÷Ä’ø’•’¶’®",
    btn_route: "‘µ÷Ä’©’∏÷Ç’≤’´",
    
    nav_stays: "‘ø’°÷Å’°÷Ä’°’∂’∂’•÷Ä",
    stays_title: "‘ø’°÷Å’°÷Ä’°’∂’∂’•÷Ä",
    stays_subtitle: "’Ñ’´ ÷Ñ’°’∂’´ ’∞’°’Ω÷Å’•’∂’•÷Ä’ù ’§’≤’µ’°’Ø’´ ’¥’∏’ø’°’Ø’°’µ÷Ñ’∏÷Ç’¥",
    stays_note: "’ç’´÷Ä’•’¨’´ ’∞’µ’∏÷Ç÷Ä’•÷Ä üíõ ’•’©’• ÷Å’°’∂’Ø’°’∂’∏÷Ç’¥ ’•÷Ñ ’¥’∂’°’¨ ’¥’∏’ø’°’Ø’°’µ÷Ñ’∏÷Ç’¥ ÷á ’¨’´’∏’æ’´’∂ ’æ’°’µ’•’¨’•’¨ ’•÷Ä’•’Ø’∏’∂, ’°’∞’° ’¥’´ ÷Ñ’°’∂’´ ’°’º’°’ª’°÷Ä’Ø÷â ‘ø’°÷Ä’∏’≤ ’•÷Ñ ’°’∂’¥’´’ª’°’∫’•’Ω ’Ø’°’∫ ’∞’°’Ω’ø’°’ø’•’¨ ÷á ’°’¥÷Ä’°’£÷Ä’•’¨÷â",
    stay_call: "‘∂’°’∂’£’°’∞’°÷Ä’•’¨",

    rsvp_title: "’Ñ’°’Ω’∂’°’Ø÷Å’∏÷Ç’©’µ’°’∂ ’±÷á",
    rsvp_subtitle: "‘Ω’∂’§÷Ä’∏÷Ç’¥ ’•’∂÷Ñ ’¨÷Ä’°÷Å’∂’•’¨ ÷á ’∞’°’Ω’ø’°’ø’•’¨ ’Å’•÷Ä ’¥’°’Ω’∂’°’Ø÷Å’∏÷Ç’©’µ’∏÷Ç’∂’®",
    rsvp_deadline: "‘Ω’∂’§÷Ä’∏÷Ç’¥ ’•’∂÷Ñ ’∞’°’Ω’ø’°’ø’•’¨ ’Å’•÷Ä ’¥’°’Ω’∂’°’Ø÷Å’∏÷Ç’©’µ’∏÷Ç’∂’® ’¥’´’∂’π÷á 12 ’°’∫÷Ä’´’¨ 2026÷â",

    footer_names: "‘±’∂’§÷Ä’• ÷á ‘º’∏÷Ç’Ω’´’∂’•",
    footer_meta: "9 ’¥’°’µ’´’Ω 2026 ‚Äî ’Ü’°’∂’Ω’´"
  }
};

// Apply translations
function setLang(lang) {
  const dict = i18n[lang] || i18n.fr;
  document.documentElement.lang = lang;
  document.title = dict.meta_title || document.title;

  document.querySelectorAll(".lang__btn").forEach(btn => {
    btn.classList.toggle("is-active", btn.dataset.lang === lang);
  });

  document.querySelectorAll("[data-i18n]").forEach(el => {
    const key = el.getAttribute("data-i18n");
    const val = dict[key];
    if (typeof val === "string") el.textContent = val;
  });

  localStorage.setItem("lang", lang);
}

function getQueryLang() {
  const p = new URLSearchParams(location.search);
  const q = p.get("lang");
  if (q === "fr" || q === "hy") return q;
  return null;
}

function lockScroll(lock) {
  document.documentElement.classList.toggle("no-scroll", !!lock);
  document.body.classList.toggle("no-scroll", !!lock);
}

// Burger menu (avec overlay + clic ext√©rieur + no-scroll)
function initBurger() {
  const burger = document.querySelector(".burger");
  const nav = document.querySelector(".nav");
  const overlay = document.getElementById("navOverlay");
  if (!burger || !nav || !overlay) return;

  const open = () => {
    nav.classList.add("is-open");
    burger.setAttribute("aria-expanded", "true");
    overlay.hidden = false;
    requestAnimationFrame(() => overlay.classList.add("is-on"));
    lockScroll(true);
  };

  const close = () => {
    nav.classList.remove("is-open");
    burger.setAttribute("aria-expanded", "false");
    overlay.classList.remove("is-on");
    lockScroll(false);
    setTimeout(() => { overlay.hidden = true; }, 180);
  };

  burger.addEventListener("click", () => {
    const isOpen = nav.classList.contains("is-open");
    isOpen ? close() : open();
  });

  overlay.addEventListener("click", close);

  nav.querySelectorAll("a.nav__link").forEach(a => {
    a.addEventListener("click", () => close());
  });

  document.addEventListener("click", (e) => {
    const isOpen = nav.classList.contains("is-open");
    if (!isOpen) return;
    const target = e.target;
    if (nav.contains(target) || burger.contains(target)) return;
    close();
  });

  window.addEventListener("keydown", (e) => {
    if (e.key === "Escape") close();
  });
}

// Lightbox (focus + no-scroll)
function initLightbox() {
  const lb = document.getElementById("lightbox");
  const lbImg = lb?.querySelector(".lightbox__img");
  const closeBtn = lb?.querySelector(".lightbox__close");
  if (!lb || !lbImg || !closeBtn) return;

  let lastFocus = null;

  const open = (src) => {
    lastFocus = document.activeElement;
    lbImg.src = src;
    lb.classList.add("is-open");
    lb.setAttribute("aria-hidden", "false");
    lockScroll(true);
    closeBtn.focus({ preventScroll: true });
  };

  const close = () => {
    lb.classList.remove("is-open");
    lb.setAttribute("aria-hidden", "true");
    lbImg.src = "";
    lockScroll(false);
    if (lastFocus && typeof lastFocus.focus === "function") {
      lastFocus.focus({ preventScroll: true });
    }
  };

  document.querySelectorAll(".gallery-bento a").forEach(a => {
    a.addEventListener("click", (e) => {
      e.preventDefault();
      open(a.getAttribute("href"));
    });
  });

  closeBtn.addEventListener("click", close);
  lb.addEventListener("click", (e) => {
    if (e.target === lb) close();
  });
  window.addEventListener("keydown", (e) => {
    if (e.key === "Escape") close();
  });
}

// Countdown
let countdownTimerId = null;

function startCountdown(targetISO) {
  const el = document.getElementById("countdown");
  if (!el) return;

  const nodes = {
    days: el.querySelector('[data-cd="days"]'),
    hours: el.querySelector('[data-cd="hours"]'),
    minutes: el.querySelector('[data-cd="minutes"]'),
    seconds: el.querySelector('[data-cd="seconds"]')
  };

  const target = new Date(targetISO).getTime();

  const tick = () => {
    const now = Date.now();
    let diff = Math.max(0, target - now);

    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
    diff -= days * (1000 * 60 * 60 * 24);

    const hours = Math.floor(diff / (1000 * 60 * 60));
    diff -= hours * (1000 * 60 * 60);

    const minutes = Math.floor(diff / (1000 * 60));
    diff -= minutes * (1000 * 60);

    const seconds = Math.floor(diff / 1000);

    nodes.days.textContent = String(days);
    nodes.hours.textContent = String(hours).padStart(2, "0");
    nodes.minutes.textContent = String(minutes).padStart(2, "0");
    nodes.seconds.textContent = String(seconds).padStart(2, "0");
  };

  tick();
  if (countdownTimerId) clearInterval(countdownTimerId);
  countdownTimerId = setInterval(tick, 1000);
}

// Init
(function init() {
  initBurger();
  initLightbox();

  // lang init priority: query > saved > browser
  const q = getQueryLang();
  const saved = localStorage.getItem("lang");
  const browser = (navigator.language || "fr").startsWith("hy") ? "hy" : "fr";
  const initial = q || saved || browser;

  setLang(initial);

  document.querySelectorAll(".lang__btn").forEach(btn => {
    btn.addEventListener("click", () => setLang(btn.dataset.lang));
  });

  // Countdown vers la c√©r√©monie civile √† Nancy (CEST +02:00)
  startCountdown("2026-05-09T16:00:00+02:00");
})();
